(this.webpackJsonpreddit_redux=this.webpackJsonpreddit_redux||[]).push([[0],{32:function(e,t,r){},34:function(e,t,r){},35:function(e,t,r){},36:function(e,t,r){},37:function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"topics",(function(){return w})),r.d(n,"posts",(function(){return M}));var i=r(1),s=r(0),c=r(11),o=r.n(c),a=r(10),u=r(8),d=r(20),l=r(3),p=r(4),h=r(6),f=r(5),b=r(2),j=r.n(b),v="topics.TOPICS_FETCHED",y="topics.TOPICS_SELECTED",O="topics.TOPIC_SELECTION_FINALIZED",k=r(12),g=r.n(k),m=g()({topicsByUrl:void 0,selectedTopicUrls:[],selectionFinalized:!1});function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case v:return e.merge({topicsByUrl:t.topicsByUrl});case y:return e.merge({selectedTopicUrls:t.selectedTopicUrls});case O:return e.merge({selectionFinalized:!0});default:return e}}function x(e){return e.topics.selectedTopicUrls}function I(e){return j.a.mapValues(j.a.keyBy(e.topics.selectedTopicUrls),(function(t){return e.topics.topicsByUrl[t]}))}function C(e){return 3===e.topics.selectedTopicUrls.length}function B(e){return e.topics.selectionFinalized}var S=r(13),F=(r(32),r(7)),T=r.n(F),E=r(9),U="https://www.reddit.com",_=new(function(){function e(){Object(l.a)(this,e)}return Object(p.a)(e,[{key:"getDefaultSubreddits",value:function(){var e=Object(E.a)(T.a.mark((function e(){var t,r,n,i;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(U,"/subreddits/default.json"),e.next=3,fetch(t,{method:"GET",headers:{Accept:"application/json"}});case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("RedditService getDefaultSubreddits failed, HTTP status ".concat(r.status));case 6:return e.next=8,r.json();case 8:if(n=e.sent,i=j.a.get(n,"data.children")){e.next=12;break}throw new Error("RedditService getDefaultSubreddits failed, children not returned");case 12:return e.abrupt("return",j.a.map(i,(function(e){return{title:j.a.get(e,"data.display_name"),description:j.a.get(e,"data.public_description"),url:j.a.get(e,"data.url")}})));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getPostsFromSubreddit",value:function(){var e=Object(E.a)(T.a.mark((function e(t){var r,n,i,s,c=this;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(U).concat(t,"hot.json"),e.next=3,fetch(r,{method:"GET",headers:{Accept:"application/json"}});case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("RedditService getPostsFromSubreddit failed, HTTP status ".concat(n.status));case 6:return e.next=8,n.json();case 8:if(i=e.sent,s=j.a.get(i,"data.children")){e.next=12;break}throw new Error("RedditService getPostsFromSubreddit failed, children not returned");case 12:return e.abrupt("return",j.a.map(s,(function(e){var r=j.a.get(e,"data.selftext_html");return{id:j.a.get(e,"data.id"),title:j.a.get(e,"data.title"),topicUrl:t,body:r,thumbnail:c._validateUrl(j.a.get(e,"data.thumbnail")),url:r?void 0:c._validateUrl(j.a.get(e,"data.url"))}})));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_validateUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.startsWith("http")?e:void 0}}]),e}());var P=function(e){Object(h.a)(r,e);var t=Object(f.a)(r);function r(){return Object(l.a)(this,r),t.apply(this,arguments)}return Object(p.a)(r,[{key:"render",value:function(){return Object(i.jsx)("ul",{children:j.a.map(this.props.rowsIdArray,this.renderRowById.bind(this))})}},{key:"renderRowById",value:function(e){return Object(i.jsx)("li",{children:this.props.renderRow(e,j.a.get(this.props.rowsById,e))},e)}}]),r}(s.Component),R=function(e){Object(h.a)(r,e);var t=Object(f.a)(r);function r(){return Object(l.a)(this,r),t.apply(this,arguments)}return Object(p.a)(r,[{key:"render",value:function(){var e=this.props.selected?"#c0f0ff":"#fff";return Object(i.jsx)("div",{style:{backgroundColor:e},onClick:this.onClick.bind(this),children:this.props.children})}},{key:"onClick",value:function(){this.props.onClick(this.props.rowId)}}]),r}(s.Component),N=function(e){Object(h.a)(r,e);var t=Object(f.a)(r);function r(){return Object(l.a)(this,r),t.apply(this,arguments)}return Object(p.a)(r,[{key:"componentDidMount",value:function(){this.props.dispatch(function(){var e=Object(E.a)(T.a.mark((function e(t,r){var n,i;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.getDefaultSubreddits();case 3:n=e.sent,i=j.a.keyBy(n,(function(e){return e.url})),t({type:v,topicsByUrl:i}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"render",value:function(){return this.props.rowsById?Object(i.jsxs)("div",{className:"TopicsScreen",children:[Object(i.jsx)(P,{rowsIdArray:this.props.rowsIdArray,rowsById:this.props.rowsById,renderRow:this.renderRow.bind(this)}),!!this.props.canFinalizeSelection&&Object(i.jsx)("button",{className:"NextScreen",onClick:this.onNextScreenClick.bind(this)})]}):this.renderLoading()}},{key:"renderLoading",value:function(){return Object(i.jsx)("p",{children:"Loading..."})}},{key:"renderRow",value:function(e,t){var r=this.props.selectedRowsById[e];return Object(i.jsxs)(R,{rowId:e,onClick:this.onRowClick.bind(this),selected:r,children:[Object(i.jsx)("h3",{children:t.title}),Object(i.jsx)("p",{children:t.description})]})}},{key:"onRowClick",value:function(e){var t;this.props.dispatch((t=e,function(e,r){var n=x(r());if(-1===j.a.indexOf(n,t)){var i=n.length<3?n.concat(t):n.slice(1).concat(t);e({type:y,selectedTopicUrls:i})}}))}},{key:"onNextScreenClick",value:function(){this.props.dispatch({type:O})}}]),r}(s.Component);var L=Object(u.b)((function(e){var t=function(e){var t=e.topics.topicsByUrl;return[t,j.a.keys(t)]}(e),r=Object(S.a)(t,2);return{rowsById:r[0],rowsIdArray:r[1],selectedRowsById:I(e),canFinalizeSelection:C(e)}}))(N),A=(r(34),"posts.POSTS_FETCHED"),D="posts.FILTER_CHANGED",z="posts.POST_SELECTED";var H=g()({postsById:void 0,currentFilter:"all",currentPostId:void 0});function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case A:return e.merge({postsById:t.postsById});case D:return e.merge({currentFilter:t.filter});case z:return e.merge({currentPostId:t.postId});default:return e}}function W(e){return e.posts.currentFilter}function G(e){return j.a.get(e.posts.postsById,e.posts.currentPostId)}var J=function(e){Object(h.a)(r,e);var t=Object(f.a)(r);function r(){return Object(l.a)(this,r),t.apply(this,arguments)}return Object(p.a)(r,[{key:"render",value:function(){var e=this;return Object(i.jsxs)("div",{className:this.props.className,children:[this.renderFilter("all","All"),j.a.map(this.props.topics,(function(t,r){return e.renderFilter(r,t.title)}))]})}},{key:"renderFilter",value:function(e,t){var r=this,n=this.props.selected===e?"selected":void 0;return Object(i.jsx)("a",{href:"#",className:n,onClick:function(){return r.onFilterClick(e)},children:t},e)}},{key:"onFilterClick",value:function(e){e!==this.props.selected&&this.props.onChanged(e)}}]),r}(s.Component),q=function(e){Object(h.a)(r,e);var t=Object(f.a)(r);function r(){return Object(l.a)(this,r),t.apply(this,arguments)}return Object(p.a)(r,[{key:"render",value:function(){return this.props.post?this.props.post.body?this.renderBody():this._isImage(this.props.post.url)?this.renderImage():this.renderUrl():this.renderEmpty()}},{key:"renderEmpty",value:function(){return Object(i.jsx)("div",{children:Object(i.jsx)("h3",{children:"Select a post to view"})})}},{key:"renderBody",value:function(){return Object(i.jsx)("div",{dangerouslySetInnerHTML:this._getBodyMarkup(this.props.post.body)})}},{key:"renderImage",value:function(){return Object(i.jsx)("img",{src:this.props.post.url,alt:this.props.post.title})}},{key:"renderUrl",value:function(){return Object(i.jsxs)("div",{children:[Object(i.jsx)("h3",{children:"External Link"}),Object(i.jsx)("a",{href:this.props.post.url,target:"_blank",children:"Open"})]})}},{key:"_getBodyMarkup",value:function(e){return{__html:e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(t)})).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}}},{key:"_isImage",value:function(e){return!!e&&(e.endsWith(".jpg")||e.endsWith(".gif")||e.endsWith(".png"))}}]),r}(s.Component),V=function(e){Object(h.a)(r,e);var t=Object(f.a)(r);function r(){return Object(l.a)(this,r),t.apply(this,arguments)}return Object(p.a)(r,[{key:"componentDidMount",value:function(){this.props.dispatch(function(){var e=Object(E.a)(T.a.mark((function e(t,r){var n,i,s,c;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=x(r()),i=j.a.map(n,(function(e){return _.getPostsFromSubreddit(e)})),e.next=5,Promise.all(i);case 5:s=e.sent,c=j.a.keyBy(j.a.shuffle(j.a.flatten(s)),(function(e){return e.id})),t({type:A,postsById:c}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"render",value:function(){return this.props.rowsById?Object(i.jsxs)("div",{className:"PostsScreen",children:[Object(i.jsxs)("div",{className:"LeftPane",children:[Object(i.jsx)(J,{className:"TopicFilter",topics:this.props.topicsByUrl,selected:this.props.currentFilter,onChanged:this.onFilterChanged.bind(this)}),Object(i.jsx)(P,{rowsIdArray:this.props.rowsIdArray,rowsById:this.props.rowsById,renderRow:this.renderRow.bind(this)})]}),Object(i.jsx)("div",{className:"ContentPane",children:Object(i.jsx)(q,{post:this.props.currentPost})})]}):this.renderLoading()}},{key:"renderLoading",value:function(){return Object(i.jsx)("p",{children:"Loading..."})}},{key:"renderRow",value:function(e,t){var r=this.props.currentPost===t;return Object(i.jsxs)(R,{rowId:e,onClick:this.onRowClick.bind(this),selected:r,children:[!!t.thumbnail&&Object(i.jsx)("img",{className:"thumbnail",src:t.thumbnail,alt:"thumbnail"}),Object(i.jsx)("h3",{children:t.title})]})}},{key:"onFilterChanged",value:function(e){this.props.dispatch(function(e){return{type:D,filter:e}}(e))}},{key:"onRowClick",value:function(e){this.props.dispatch({type:z,postId:e})}}]),r}(s.Component);var Z=Object(u.b)((function(e){var t=function(e){var t=e.posts.currentFilter,r=e.posts.postsById,n="all"===t?j.a.keys(r):j.a.filter(j.a.keys(r),(function(e){return r[e].topicUrl===t}));return[r,n]}(e),r=Object(S.a)(t,2);return{rowsById:r[0],rowsIdArray:r[1],topicsByUrl:I(e),currentFilter:W(e),currentPost:G(e)}}))(V),K=(r(35),function(e){Object(h.a)(r,e);var t=Object(f.a)(r);function r(){return Object(l.a)(this,r),t.apply(this,arguments)}return Object(p.a)(r,[{key:"render",value:function(){return Object(i.jsx)("div",{className:"App",children:this.props.isSelectionFinalized?Object(i.jsx)(Z,{}):Object(i.jsx)(L,{})})}}]),r}(s.Component));var Q=Object(u.b)((function(e){return{isSelectionFinalized:B(e)}}))(K),X=(r(36),Object(a.d)(Object(a.c)(n),Object(a.a)(d.a)));o.a.render(Object(i.jsx)(u.a,{store:X,children:Object(i.jsx)(Q,{})}),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.139e10c9.chunk.js.map